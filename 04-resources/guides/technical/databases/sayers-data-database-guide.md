# SAYERS DATA Supabase Database

> [!tip] Quick Summary
> Your complete financial database for tracking invoices, payments, and business operations across multiple entities (Harrison Sayers, MOKAI, Mok House) with automated categorization and ML-powered insights.

---
tags: [resources, guides, documentation]
relation:
  - "[[resources]]"
  - "[[resources]]"

## Quick Overview

**What is SAYERS DATA?**
Your Supabase database (`gshsshaodoyttdxippwx`) is the central hub for all financial data - invoices, transactions, contacts, and business operations. It automatically categorizes transactions, detects anomalies, and generates reports for tax time.

**Why use it?**
All your business finances in one place with ==automatic categorization==, ML predictions, and ready-to-go tax reports. No manual spreadsheet work needed.

---

## Database Structure

### Core Tables (How Everything Connects)

**1. `entities`** - Your businesses
- ==Harrison Robert Sayers== (sole trader)
- ==MOKAI PTY LTD== (cybersecurity consultancy)
- ==MOK HOUSE PTY LTD== (music business)

**2. `contacts`** - Business contacts & vendors
- Clients who pay you
- Suppliers you pay
- Links to entities via `entity_id`

**3. `invoices`** - All bills (in & out)
- **Receivables** (`type: 'receivable'`) - Money coming in
- **Payables** (`type: 'payable'`) - Money going out
- Links to: `entity_id`, `contact_id`

**4. `invoice_line_items`** - Individual line items
- What's on each invoice
- Quantities, prices, tax
- Links to: `invoice_id`

**5. `transactions`** - Actual money movements
- Bank transactions from Up Bank
- Auto-categorized by ML model
- Links to: `entity_id`, `account_id`

**6. `transaction_categories`** - Category definitions
- Business expenses
- Tax-deductible items
- Revenue streams

**7. `accounts`** - Bank accounts
- Up Bank accounts
- Links to: `entity_id`

### Smart Features Tables

**8. `financial_ml_predictions`** - AI categorization
- ==Confidence scores== (>0.9 = auto, 0.7-0.9 = review, <0.7 = manual)
- Category predictions
- Links to: `transaction_id`

**9. `anomaly_detections`** - Unusual transactions
- Fraud detection
- Outlier identification
- Severity levels

**10. `cash_flow_forecasts`** - Future predictions
- 30-day forecasts
- Confidence intervals
- Links to: `entity_id`

---

## How Tables Relate

```
entities (businesses)
    ├── contacts (clients/vendors)
    │   └── invoices (bills)
    │       └── invoice_line_items (details)
    ├── accounts (bank accounts)
    │   └── transactions (money movements)
    │       ├── financial_ml_predictions (AI categories)
    │       └── anomaly_detections (fraud alerts)
    └── cash_flow_forecasts (predictions)
```

**Key Relationships:**
- Every invoice belongs to an entity and contact
- Every transaction belongs to an entity and account
- ML predictions link to transactions
- Forecasts link to entities

---

## Can You Edit Directly?

### ✅ Safe to Edit in Supabase UI

- **`contacts`** - Add/edit clients and vendors
- **`transaction_categories`** - Customize categories
- **`invoices`** - Manual invoice creation/fixes
- **`invoice_line_items`** - Adjust line items

### ⚠️ Be Careful With

- **`transactions`** - Synced from Up Bank (edits may be overwritten)
- **`entities`** - Core business data (structural)
- **`accounts`** - Bank account links (structural)

### ❌ Don't Touch

- **`financial_ml_predictions`** - Auto-generated by ML
- **`anomaly_detections`** - Auto-generated by ML
- **`cash_flow_forecasts`** - Auto-generated by ML

---

## Common Queries

### Find All Unpaid Invoices

**What to look for:**
- Table: `invoices`
- Filter: `status = 'sent'` or `status = 'overdue'`
- Type: `type = 'receivable'`

### Get Business Expenses for Tax

**What to look for:**
- Table: `transactions`
- Join: `transaction_categories` where `is_tax_deductible = true`
- Filter by: `entity_id` and date range

### Check Cash Flow Forecast

**What to look for:**
- Table: `cash_flow_forecasts`
- Filter: `entity_id` and `forecast_date > today`
- Sort by: `forecast_date`

### Review Flagged Transactions

**What to look for:**
- Table: `anomaly_detections`
- Filter: `severity = 'high'` or `severity = 'medium'`
- Join: `transactions` to see details

---

## Automation & Integration

### Already Integrated

**✅ Up Bank Sync**
- Auto-syncs transactions every 6 hours
- ML categorization happens in real-time
- Location: `scripts/sync-upbank-enhanced.js`

**✅ MindsDB ML Pipeline**
- Categorizes transactions automatically
- Detects anomalies
- Generates forecasts
- Location: `context/finance/database/supabase-ml-pipeline.md`

### Ready to Integrate

**Stripe** (for online payments)
- Create `stripe_payments` table
- Link to `invoices` via `invoice_id`
- Auto-mark invoices as paid

**Notion** (for client management)
- Sync `contacts` to Notion database
- Two-way sync for client notes
- Invoice status updates

**Xero/QuickBooks** (accounting export)
- Export `transactions` with categories
- Map to chart of accounts
- Generate BAS/tax reports

---

## In Your Setup

**Database Location:**
- Project ID: ==`gshsshaodoyttdxippwx`==
- Project Name: ==SAYERS DATA==
- ⚠️ NOT `ihqihlwxwbpvzqsjzmjc` (old/inactive)

**MCP Tools Available:**
```bash
mcp__supabase__list_tables          # See all tables
mcp__supabase__execute_sql          # Run queries
mcp__supabase__apply_migration      # Add new features
mcp__supabase__get_advisors         # Security checks
```

**Key Files:**
- `context/finance/database/supabase-schema.md` - Full structure
- `context/finance/database/supabase-ml-pipeline.md` - ML features
- `context/finance/database/supabase-projects.md` - Invoice projects
- `scripts/sync-upbank-enhanced.js` - Sync automation

**Related Commands:**
- `/sync-upbank` - Manual transaction sync
- `/show-business-transactions` - View recent business expenses
- `/add-business-transaction` - Manual business expense entry

---

## Tax Time Workflow

**Step 1: Pull Business Transactions**
```bash
/show-business-transactions
```
Filter by entity and date range

**Step 2: Export Tax-Deductible Expenses**
Query `transactions` where:
- `is_business_expense = true`
- `category.is_tax_deductible = true`
- Date in tax year

**Step 3: Generate Income Report**
Query `invoices` where:
- `type = 'receivable'`
- `status = 'paid'`
- Date in tax year

**Step 4: Review Anomalies**
Check `anomaly_detections` for unusual transactions that might need explanation

---

> [!warning] Common Issues
> - **Wrong project error?** Always use `gshsshaodoyttdxippwx` (SAYERS DATA)
> - **Transaction missing?** Run `/sync-upbank` to sync from Up Bank
> - **Category wrong?** Check ML confidence score - low score = needs manual review
> - **Duplicate transactions?** Check `reference_number` - duplicates are auto-prevented

> [!tip] Pro Tips
> - Use ==confidence scores== to find transactions needing review (0.7-0.9)
> - Set up business keywords via `/add-business-keyword` for auto-categorization
> - Check forecasts weekly to predict cash flow issues early
> - Export tax data quarterly, not just at year-end
